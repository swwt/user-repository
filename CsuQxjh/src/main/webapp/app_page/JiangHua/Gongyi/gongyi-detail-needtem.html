<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>E3父子模版，可直接用index的父子模版</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/own.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<script src="../jsHostName/hostName.js"></script>
		<style type="text/css">
			.mui-backdrop {
				position: fixed;
				top: 0;
				right: 0;
				bottom: 0px;
				left: 0;
				z-index: 998;
				width: 100%;
				background-color: rgba(0, 0, 0, .6);
			}
		</style>
		<script type="text/javascript">
			var user_id;
			var news_id;
		</script>
	</head>

	<body>
		<!--<header class="mui-bar mui-bar-nav own-main-background-color" style="display: none;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">公益详情</h1>
		</header>-->

		<div class="mui-content" style="overflow-x:hidden;margin-bottom: 45px;background-color: #fff;">
			<div id="newsContent">
				<div class="gongyi-title" style="width: 100%;height: 150px;border:1px solid#fff;background-image: url(../img/xiaoningmeng.png);background-size: 100% 150px;background-repeat: no-repeat;padding-bottom: 5px;">
					<p style="width: 100%;text-align: center;font-size: 20px;font-weight: bold;color:#222222;margin-top: 90px;">小柠檬的大抱负</p>
					<p style="width: 100%; text-align: center;font-size: 14px;margin-bottom: 5px;">2016年03月22日</p>
				</div>
				<div class="gongyi-content">
					<p style="font-size: 16px;color: #333333;margin: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;果粉们的心理就是难以揣摩，当初了发布了iPhone 6的时候，一大批人嚷着iPhone 5s是史上设计最好的iPhone，那现在苹果又如你们所愿把iPhone 5s的改良版iPhone SE又发布一遍，于是大家又吵着说苹果只会炒冷饭。不过怎么样，该买的还是会买，不是么？当初iPhone 5c不也在一片骂声中卖出了很多。</p>
					<p>
						<div style="line-height:100px;margin-left:auto;margin-right: auto; width: 100px;height: 100px;border:1px double#FFAA3B;border-radius: 50%;text-align: center;vertical-align: middle;background-color: #FFAA3B;font-size: 23px; color: #fff;font-weight: bold;">捐助</div>
					</p>
					<div class="gongyi-read-good" style="font-size: 12px;color:#8D8D8D;vertical-align: middle;height: 20px;line-height: 20px;margin:12px">
						<span>阅读量：1521</span>&nbsp;
			<!--			<span><img src="../img/dianzan.png" style="width: 1em;height: 1em;border-radius: 20%;"/>：4546</span>-->
						<span style="float: right;"><img src="../img/paihangbang.png" style="vertical-align:middle;width: 1em;height: 1em;border-radius: 20%;margin-right: 2px;"/>公益排行榜</span>
					</div>
				</div>
				<div class="gongyi-comment" style="margin-top: 15px;">
					<p style="text-align: center;color: #000000;font-weight:bold;font-size: 18px;">相&nbsp;|&nbsp;关&nbsp;|&nbsp;评&nbsp;|&nbsp;论</p>
					<p style="text-align: center;padding: 0;">RELATED COMMENTS</p>
					<ul class="comment-items mui-table-view" style="border: hidden;background-color: #fff;">
						<li class="comment-item mui-table-view-cell mui-media" style="border: hidden;border:1px solid#fff;">
							<img src="../img/3.jpg" class="mui-media-object mui-pull-left" style="border-radius: 55%;width: 2.8em;" />
							<div class="mui-media-body">
								<div class="comment-header" style="color: #85878A;font-size: 14px;">
									<span class="comment-username" style="">风中秋香</span>
									<span class="comment-time" style="float: right;">32分钟前</span>
								</div>
								<div class="comment-content" style="margin-top:1em;color: #252525;">
									这个准确的说叫放音机，不能叫收音机。
								</div>
							</div>
						</li>
						<li class="comment-item mui-table-view-cell mui-media" style="">
							<img src="../img/3.jpg" class="mui-media-object mui-pull-left" style="border-radius: 55%;width: 2.8em;" />
							<div class="mui-media-body">
								<div class="comment-header" style="color: #85878A;font-size: 14px;">
									<span class="comment-username" style="">风中秋香</span>
									<span class="comment-time" style="float: right;">32分钟前</span>
								</div>
								<div class="comment-content" style="margin-top:1em;color: #252525;">
									这个准确的说叫放音机，不能叫收音机。
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
			<!--<div class="gongyi-footer" style="position: fixed;bottom: 0px;height: 45px;width: 100%;background: #fff;">
				<span style="width: 30%;display: inline-block;text-align: center;">赞</span>
				<span style="width: 30%;display: inline-block;text-align: center;">写评论</span>
				<span style="width: 30%;display: inline-block;text-align: center;">评论</span>
			</div>-->

		</div>
		<div id="commit" style="display: none;">
			<div class="comment-input" >
				<div style="position: fixed;top: 20%;left:7.5%;width: 85%;z-index: 9999;padding: 30px 10px;background-color: #eee;height: 310px;border-radius: 10px;">
					<div style="background-color:#F31717;z-index: 9999;color: white;font-weight:bold;height:40px;line-height:40px;margin-left: 5%;width: 90%;text-align: center;margin-bottom: 0;border-radius: 5px 5px 0 0;">评论框</div>
					<div class="mui-input-row" style="width: 90%;margin-left: 5%;margin-top: 0;margin-bottom: 0;">
						<textarea id="textarea" rows="6" placeholder="多行文本框"></textarea>
					</div>
					<button id="publish-comment" type="button" class="mui-btn" style="background-color:#41CEA9;color:white;font-size:16px;font-weight:bold;width: 90%;margin-left: 5%;height: 40px;">
				发布评论
					</button>
				</div>

			</div>
			<div class="mui-backdrop"></div>
		</div>
		<nav class="mui-bar mui-bar-tab ">
			<!--<a class="mui-tab-item mui-active" href="#" style="height: 45px;line-height: 45px;">
				<span class="mui-icon iconfont icon-xinyuandan" style="font-size: 19px!important;"><span class="mui-tab-label" style="font-size: 14px;margin-left: 2px;" id="commentpraise">23</span></span>
			</a>-->
			<a id="edit-comment" class="mui-tab-item" href="#">
				<span class="mui-icon iconfont icon-fenlei" style="font-size: 19px!important;"><span class="mui-tab-label" style="font-size: 14px;margin-left: 2px;" onclick="document.getElementById('commit').style.display='block'">写评论</span></span>

			</a>
			<a class="mui-tab-item" href="#">
				<span class="mui-icon iconfont icon-xiaolian" style="font-size: 19px!important;"><span class="mui-tab-label" style="font-size: 14px;margin-left: 2px;" id="commentamount">2</span></span>

			</a>
		</nav>

		<script src="../js/mui.min.js" charset="UTF-8"></script>
		<script src="../js/own.js" charset="UTF-8"></script>
		<script type="text/javascript" charset="utf-8">
			function getNewsById(gongyiID){
				mui.ajax(host+'/news/getNewsListById',{
						data:{
							newsId:gongyiID
						},
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
												
							if(data.code==1){
								var newsJSON=data.result;
								var commentsJSONs=newsJSON.newsComments;
								var newsHtml="";
								//alert(newsJSON.news_title);
								//①图片加标题加日期
								newsHtml=newsHtml
									+"<div class=\"gongyi-title\" style=\"width: 100%;height: 150px;border:1px solid#fff;background-image: url("+host+newsJSON.news_image+");background-size: 100% 150px;background-repeat: no-repeat;padding-bottom: 5px;\">"          
										+"<p style=\"width: 100%;text-align: center;font-size: 20px;font-weight: bold;color:#222222;margin-top: 90px;\">"+newsJSON.news_title+"</p>"
										+"<p style=\"width: 100%; text-align: center;font-size: 14px;margin-bottom: 5px;\">"+newsJSON.news_time+"</p>"
									+"</div>";
								//②正文
								newsHtml=newsHtml 
									+"<div class=\"gongyi-content\">"
										+"<p style=\"font-size: 16px;color: #333333;margin: 12px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+newsJSON.news_content+"</p>"
										+"<p>"
											+"<div style=\"line-height:100px;margin-left:auto;margin-right: auto; width: 100px;height: 100px;border:1px double#FFAA3B;border-radius: 50%;text-align: center;vertical-align: middle;background-color: #FFAA3B;font-size: 23px; color: #fff;font-weight: bold;\">捐助</div>"
										+"</p>"
										+"<div class=\"gongyi-read-good\" style=\"font-size: 12px;color:#8D8D8D;vertical-align: middle;height: 20px;line-height: 20px;margin:12px\">"
											+"<span>阅读量："+newsJSON.news_read_number+"</span>&nbsp;"
											//+"<span><img src=\"../img/dianzan.png\" style=\"width: 1em;height: 1em;border-radius: 20%;\"/>："+newsJSON.news_praise+"</span>"
											+"<span style=\"float: right;\"><img src=\"../img/paihangbang.png\" style=\"vertical-align:middle;width: 1em;height: 1em;border-radius: 20%;margin-right: 2px;\"/>公益排行榜</span>"
										+"</div>"
									+"</div>";
								//③评论
								newsHtml=newsHtml
										+"<div class=\"gongyi-comment\" style=\"margin-top: 15px;\">"
											+"<p style=\"text-align: center;color: #000000;font-weight:bold;font-size: 18px;\">相&nbsp;|&nbsp;关&nbsp;|&nbsp;评&nbsp;|&nbsp;论</p>"
											+"<p style=\"text-align: center;padding: 0;\">RELATED COMMENTS</p>"
											+"<ul class=\"comment-items mui-table-view\" style=\"border: hidden;background-color: #fff;\">";
								for(var i=0;i<commentsJSONs.length;i++){
									var comment=commentsJSONs[i];
									var user=comment.user;
									newsHtml=newsHtml
												+"<li class=\"comment-item mui-table-view-cell mui-media\" style=\"border: hidden;border:1px solid#fff;\">"
													+"<img src=\""+host+user.user_head_image+"\"  class=\"mui-media-object mui-pull-left\" style=\"border-radius: 55%;width: 2.8em;\"/>"
													+"<div class=\"mui-media-body\">"
														+"<div class=\"comment-header\" style=\"color: #85878A;font-size: 14px;\">"
														+"<span class=\"comment-username\" style=\"\">"+user.user_login_name+"</span>"
														+"<span class=\"comment-time\" style=\"float: right;\">"+comment.news_comment_time+"</span>"
														+"</div>"
														+"<div class=\"comment-content\" style=\"margin-top:1em;color: #252525;\">"
																+comment.news_comment_content
														+"</div>"
													+"</div>"
												+"</li>";
								}				
								newsHtml=newsHtml			
											+"</ul>"
										+"</div>";
								document.getElementById("newsContent").innerHTML=newsHtml;
								document.getElementById("commentamount").innerHTML=commentsJSONs.length;
							//	document.getElementById("commentpraise").innerHTML=newsJSON.news_praise;
							}else{//
								alert(data.message); 
							}
						},
						error:function(xhr,type,errorThrown){
							//异常处理；
							//console.log(type);
							//alert("出现错误");
						}
					});
			}
			mui.plusReady(function() {
				//adaptive();
			});
			window.addEventListener('gongyiPage', function(options) {					
				var gongyiID = options.detail.gongyiID;
				news_id=gongyiID;
				getNewsById(gongyiID);
			}, false);
		</script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				swipeBack: false
			});
			var edit_comment_btn;
			var backdrop;
			var publish_comment_btn;
			var commit_dialog;
			
			mui.plusReady(function() {
				//adaptive();
				edit_comment_btn = document.querySelector('#edit-comment');
				backdrop = document.querySelector('.mui-backdrop');
				publish_comment_btn = document.querySelector('#publish-comment');
				commit_dialog = document.querySelector('#commit');
				edit_comment_btn.addEventListener('tap', function() {
					commit_dialog.style.display = 'block';
				}, false);
				backdrop.addEventListener('tap', function(){
					commit_dialog.style.display= 'none';
				},false);
				publish_comment_btn.addEventListener('tap', function() {
					commit_dialog.style.display = 'none';
				}, false);
			});
		</script>
		<script type="text/javascript">
			mui("#commit").on('tap','#publish-comment',function(){
				if(!localStorage.getItem('user')){
					alert("请先登录");
				}else{
					var commentContent=document.getElementById("textarea").value;
					if(commentContent==''){
						alert('请输入内容');
					}else{
						userId=JSON.parse(localStorage.getItem('user')).id;
						mui.ajax(host+'/news/addNewsComment',{
							data:{
								newsId:news_id,
								userId:userId,
								commentContent:commentContent
							},
							dataType:'json',//服务器返回json格式数据
							type:'post',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							success:function(data){
								//服务器返回响应，根据响应结果，分析是否成功；							
								if(data.code==1){//评论成功
									alert(data.message);
									getNewsById(news_id);
								}else{//登录失败，给出提醒
									alert(data.message);
								}
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								//console.log(type);
								alert("出现错误");
							}
						});
					}
					
				}
				
			}) 
		</script>
	</body>

</html>