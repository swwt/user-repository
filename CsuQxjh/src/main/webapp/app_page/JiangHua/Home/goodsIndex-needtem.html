<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>jianghua</title>
		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/style.css" />
		<script src="../jsHostName/hostName.js"></script>
		<style type="text/css">
			.goodCard ul.mui-table-view li.mui-table-view-cell .item-name {
				float: left;
				color: #87898C;
				font-size: 12px;
				margin-right: 6px;
			}
			
			.goodCard ul.mui-table-view li.mui-table-view-cell .item-content {
				display: -webkit-box;
				-webkit-line-clamp: 1;
				-webkit-box-orient: vertical;
				overflow: hidden;
				font-size: 14px;
				color: #303030;
			}
			
			.goodCard .mui-table-view .mui-table-view-cell:after{
				height: 0!important;				
			}
			
			.goodCard .mui-table-view.goods-service {
				background-color: #F7F8FA;
				margin: 0;
				font-size: 12px;
				padding: 0;
			}
			
			.goodCard .mui-table-view.goods-service span {
				margin-right: 6px;
				color: #87898C;
			}
		</style>
		
	</head>

	<body>
		<div id="goods" class="mui-content-padded">
			<div class="goodCard">
				<div id="slider" class="mui-slider">					
					<!--<div class="mui-slider-group mui-slider-loop">
						<div class="mui-slider-item mui-slider-item-duplicate">
							<a href="#"><img src="../img/yuantiao.jpg"></a>
						</div>
						<div class="mui-slider-item">
							<a href="#"><img src="../img/shuijiao.jpg"></a>
						</div>
						<div class="mui-slider-item">
							<a href="#"><img src="../img/muwu.jpg"></a>
						</div>
						<div class="mui-slider-item">
							<a href="#"><img src="../img/cbd.jpg"></a>
						</div>
						<div class="mui-slider-item">
							<a href="#"><img src="../img/yuantiao.jpg"></a>
						</div>
						<div class="mui-slider-item mui-slider-item-duplicate">
							<a href="#"><img src="../img/shuijiao.jpg"></a>
						</div>
					</div>
					<div class="mui-slider-indicator">
						<div class="mui-indicator mui-active"></div>
						<div class="mui-indicator"></div>
						<div class="mui-indicator"></div>
						<div class="mui-indicator"></div>
					</div>-->
				</div>
				<div class="goodTag" id="goodsInformation">
					<!--<span class="goods-name" style="color: #232326;font-size: 16px;">湖南湘西沅陵特产&nbsp;大山野生新鲜板栗&nbsp;生板栗&nbsp;毛栗子油栗500克</span>
-->
					<div class="goods-price-des" style="margin-top: 8px;">
						<button type="button" class="mui-btn mui-btn-danger">11.90元/500g</button>
						<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined">20元/1kg</button>
					</div>

					<div class="mui-row" style="height: 30px;line-height: 30px;margin-top: 8px;">
						<span class="mui-pull-left goodPrice">￥<span style="font-size: 20px;font-weight: bold;">11.90</span></span>
						<span class="mui-pull-right">
							<button type="button" class="mui-btn mui-btn-outlined">降价通知</button>
						</span>
					</div>

				</div>

				<ul class="mui-table-view" style="border-top: 0.8em solid#F0F2F5;">
					<li class="mui-table-view-cell" >
						<span class="item-name" style="">促销</span>
						<span class="item-content">
							满600.00加送35.00 或 满1000.00加送50.00
						</span>
					</li>
					<li class="mui-table-view-cell">
						<span class="item-name">已选</span>
						<span class="item-content">500g, &nbsp;1个
							<span class="mui-icon mui-icon-more mui-pull-right"></span>
						</span>

					</li>
					<li class="mui-table-view-cell">
						<span class="item-name">送至</span>
						<!--<span class="mui-icon mui-icon-location" style="font-size: 20px;color: #D3524D;"></span>-->
						<span class="item-content" style="">湖南长沙市天心区中南大学铁道学院
							<span class="mui-icon mui-icon-more mui-pull-right"></span>
						</span>
					</li>
					<li class="mui-table-view-cell">
						<span class="item-name">运费</span>
						<span class="item-content">店铺单笔订单不满99元，在线支付运费10元
						</span>
					</li>
				</ul>
				<ul class="goods-service mui-table-view">
					<li class="mui-table-view-cell" style="text-align: left;">
						<span>店铺发货&售后</span>
						<span>不可七天退货</span>
					</li>
				</ul>

				<div class="bones mui-row">

				</div>
			</div>
			<div class="goodCard">
				<div class="goodTag">
					<div id="goodSlider" class="mui-slider">
						<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
							<a class="mui-control-item" href="#item1mobile">商品介绍</a>
							<a class="mui-control-item" href="#item2mobile">规格参数</a>
							<a class="mui-control-item" href="#item3mobile">包装售后</a>
							<a class="mui-control-item" href="#item4mobile">评价(1005)</a>
						</div>
						<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-3"></div>
						<div class="mui-slider-group">
							<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
								
							</div>
							<div id="item2mobile" class="mui-slider-item mui-control-content">
								<!--<table border="1" width="97%">
									<tr>
										<td colspan="2">商品名</td>
									</tr>
									<tr>
										<td>类别</td>
										<td>豆类</td>
									</tr>
									<tr>
										<td>特性</td>
										<td>其他</td>
									</tr>
									<tr>
										<td>口味</td>
										<td>香辣味</td>
									</tr>
									<tr>
										<td>包装</td>
										<td>袋装</td>
									</tr>
									<tr>
										<td>国别</td>
										<td>国产</td>
									</tr>
								</table>-->
							</div>
							<div id="item3mobile" class="mui-slider-item mui-control-content">
   								
							</div>
							<div id="item4mobile" class="mui-slider-item mui-control-content">
								<!--<div class="mui-row mui-text-center mui-content-padded">
									<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined">好评 94%</button>
									<button type="button" class="mui-btn mui-btn-warning mui-btn-outlined">中评 4%</button>
									<button type="button" class="mui-btn mui-btn-royal mui-btn-outlined">差评 2%</button>
								</div>-->
								<!--<ul class="mui-table-view mui-grid-view">
									<li class="mui-table-view-cell mui-media mui-col-xs-12">
										<div class="comment">
											<div class="mui-row">
												<span class="CommentStar mui-pull-left">
											<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-starhalf"></span>
												<span class="mui-icon mui-icon-star"></span>
												</span>
												<span class="CommentUser mui-pull-right">
											评价用户名
												</span>
											</div>
											<p class="commentContent mui-text-left"> 幸福就是可以一起睡觉幸福就是可以一起睡觉幸福就是可以一起睡觉幸福就是可以一起睡觉 </p>
											<div class="commentPic mui-row">
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
											</div>
											<div class="mui-row">
												<span class="CommentUser mui-pull-right">
												<p>2016-04-04 12:12:12</p>
												</span>
											</div>
										</div>
										<div class="comment">
											<div class="mui-row">
												<span class="CommentStar mui-pull-left">
											<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-starhalf"></span>
												<span class="mui-icon mui-icon-star"></span>
												</span>
												<span class="CommentUser mui-pull-right">
											评价用户名
										</span>
											</div>
											<p class="commentContent mui-text-left"> 幸福就是可以一起睡觉幸福就是可以一起睡觉幸福就是可以一起睡觉幸福就是可以一起睡觉 </p>
											<div class="commentPic mui-row">
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
											</div>
										</div>
										<div class="comment">
											<div class="mui-row">
												<span class="CommentStar mui-pull-left">
											<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-star-filled"></span>
												<span class="mui-icon mui-icon-starhalf"></span>
												<span class="mui-icon mui-icon-star"></span>
												</span>
												<span class="CommentUser mui-pull-right">
											评价用户名
										</span>
											</div>
											<p class="commentContent mui-text-left"> 幸福就是可以一起睡觉幸福就是可以一起睡觉幸福就是可以一起睡觉幸福就是可以一起睡觉 </p>
											<div class="commentPic mui-row">
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
												<div class="mui-col-xs-3">
													<img class="mui-media-object" src="../img/shuijiao.jpg">
												</div>
											</div>
										</div>
										<div class="mui-content-padded">
											<ul class="mui-pager">
												<li class="mui-previous mui-disabled">
													<a href="#">
												上一页
											</a>
												</li>
												<li class="mui-next">
													<a href="#">
												下一页
											</a>
												</li>
											</ul>
										</div>
									</li>
								</ul>-->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/main.js"></script>
		<script type="text/javascript">
			function getGoodsDetail(goodsID){
				//alert(goodsID);
				mui.ajax(host+'/goods/getGoodsById',{
						data:{
						 goodsId:goodsID
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
								var goodsJSON=data.result;
								var goodsDetailJSON=goodsJSON.goodsDetail;
								var goodsComments=goodsJSON.goodsComments;//该商品对应的评价
								var goodsImages=goodsJSON.images;//商品的图片
								var goodsDetailImages=goodsDetailJSON.images;//商品详情对应的图片
								var goodsCommentsRate=goodsJSON.goods_grade;//商品的好中差评率
								//alert(goodsImages.length);
								//0.设置4个小栏目
								var titleSonHtml=""
												+"<a class=\"mui-control-item\" href=\"#item1mobile\">商品介绍</a>"
												+"<a class=\"mui-control-item\" href=\"#item2mobile\">规格参数</a>"
												+"<a class=\"mui-control-item\" href=\"#item3mobile\">包装售后</a>"
												+"<a class=\"mui-control-item\" href=\"#item4mobile\">评价("+goodsComments.length+")</a>";
								document.getElementById("sliderSegmentedControl").innerHTML=titleSonHtml;
								//1.构造图片轮播
								var sliderHtml=""
											+"<div class=\"mui-slider-group mui-slider-loop\">"
												+"<div class=\"mui-slider-item mui-slider-item-duplicate\">"
													+"<a href=\"#\"><img src=\""+host+goodsImages[goodsImages.length-1].goods_image_src+"\"></a>"
												+"</div>";	
								for(var i=0;i<goodsImages.length;i++){
									//alert(i);
									sliderHtml=sliderHtml
												+"<div class=\"mui-slider-item\">"
													+"<a href=\"#\"><img src=\""+host+goodsImages[i].goods_image_src+"\"></a>"
												+"</div>";
								}
									sliderHtml=sliderHtml
												+"<div class=\"mui-slider-item mui-slider-item-duplicate\">"
													+"<a href=\"#\"><img src=\""+host+goodsImages[0].goods_image_src+"\"></a>"
												+"</div>"
											+"</div>";
									sliderHtml=sliderHtml
												+"<div class=\"mui-slider-indicator\">"
													+"<div class=\"mui-indicator mui-active\"></div>";
								for(var i=0;i<goodsImages.length-1;i++){
									//alert(i);
									sliderHtml=sliderHtml
													+"<div class=\"mui-indicator\"></div>";
								}		
									sliderHtml=sliderHtml
												+"</div>";
								//alert(sliderHtml);
								document.getElementById("slider").innerHTML=sliderHtml;
								
/*								mui.plusReady(function(){
     								console.log("当前页面html："+sliderHtml);
								});*/
								mui.plusReady(function(){
										var gallery = mui('.mui-slider');
											gallery.slider({
								  			interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
										});
								});
								
								//2.设置商品名称价格等基本信息
								var goodsPrices=goodsJSON.goodsPrices;
								var goodsInformationHtml=""
														+"<span class=\"goods-name\" style=\"color: #232326;font-size: 16px;\">"
														+goodsJSON.goods_name+"</span>"
														+"<div class=\"goods-price-des\" style=\"margin-top: 8px;\">"
															+"<button type=\"button\" class=\"mui-btn mui-btn-danger\">11.90元/500g</button>"
															+"<button type=\"button\" class=\"mui-btn mui-btn-danger mui-btn-outlined\">20元/1kg</button>"
														+"</div>"
														+"<div class=\"mui-row\" style=\"height: 30px;line-height: 30px;margin-top: 8px;\">"
														+"<span class=\"mui-pull-left goodPrice\">￥<span style=\"font-size: 20px;font-weight: bold;\">"+goodsDetailJSON.goods_detail_now_price+"</span></span>"
															+"<span class=\"mui-pull-right\">"
																+"<button type=\"button\" class=\"mui-btn mui-btn-outlined\">降价通知</button>"
															+"</span>"
														+"</div>";
								document.getElementById("goodsInformation").innerHTML=goodsInformationHtml;
								
								//3.促销，送至，运费等其他内容
								
								//4.商品介绍（商品详情图片）
								var goodsDetailImageHtml=""
													+"<ul class=\"mui-table-view\">";														
								for(var i=0;i<goodsDetailImages.length;i++){
									goodsDetailImageHtml=goodsDetailImageHtml
													+"<li class=\"mui-table-view-cell\">"
														+"<img src=\""+host+goodsDetailImages[i].goods_detail_image_src+"\">"
													+"</li>";				
								}
								goodsDetailImageHtml=goodsDetailImageHtml
													+"</ul>";
								document.getElementById("item1mobile").innerHTML=goodsDetailImageHtml;
								
								//5.商品规格参数
								var goodsDetailSizeHtml=""
														+"<table border=\"1\" width=\"97%\">"
															+"<tr>"
																+"<td>类别</td>"
																+"<td></td>"
															+"</tr>"
															+"<tr>"
																+"<td>保质期</td>"
																+"<td>"+goodsDetailJSON.goods_detail_shelf_life+"</td>"
															+"</tr>"
															+"<tr>"
																+"<td>口味</td>"
																+"<td></td>"
															+"</tr>"
															+"<tr>"
																+"<td>包装</td>"
																+"<td></td>"
															+"</tr>"
															+"<tr>"
																+"<td>产地</td>"
																+"<td>"+goodsDetailJSON.goods_detail_producttion_place+"</td>"
															+"</tr>"
														+"</table>";
								document.getElementById("item2mobile").innerHTML=goodsDetailSizeHtml;
								
								//6.包装售后
								var goodsDetailPackageSale=""
															+"<ul class=\"mui-table-view\">"
																+"<li class=\"mui-table-view-cell\">"										
																	+"<span>"+goodsDetailJSON.goods_detail_package_sale+"</span>"
																+"</li>"											
															+"</ul>";
								document.getElementById("item3mobile").innerHTML=goodsDetailPackageSale;
								
								//7.评价
								//①好评率
								var goodsCommentHtml=""
												+"<div class=\"mui-row mui-text-center mui-content-padded\">"
													+"<button type=\"button\" class=\"mui-btn mui-btn-danger mui-btn-outlined\">好评"+(goodsCommentsRate.good)+"%</button>"
													+"<button type=\"button\" class=\"mui-btn mui-btn-warning mui-btn-outlined\">中评"+(goodsCommentsRate.medium)+"%</button>"
													+"<button type=\"button\" class=\"mui-btn mui-btn-royal mui-btn-outlined\">差评"+(goodsCommentsRate.bad)+"%</button>"                                                                                        
												+"</div>";
								//②具体评价内容
								goodsCommentHtml=goodsCommentHtml
								+"<ul class=\"mui-table-view mui-grid-view\">"
									+"<li class=\"mui-table-view-cell mui-media mui-col-xs-12\">";	
									
								for(var i=0;i<goodsComments.length;i++){
									goodsCommentHtml=goodsCommentHtml
														+"<div class=\"comment\">"
															+"<div class=\"mui-row\">"
																+"<span class=\"CommentStar mui-pull-left\">";
									var goodsComent=goodsComments[i];
									var starAmount=goodsComent.goods_comment_grade;
									for(var j=0;j<starAmount;j++){//满格五角星
										goodsCommentHtml=goodsCommentHtml
																+"<span class=\"mui-icon mui-icon-star-filled\"></span>";		
									}
									for(var j=0;j<5-starAmount;j++){//未选中五角星
										goodsCommentHtml=goodsCommentHtml
																+"<span class=\"mui-icon mui-icon-star\"></span>";		
									}
									goodsCommentHtml=goodsCommentHtml
																+"</span>"
																+"<span class=\"CommentUser mui-pull-right\">"
																	+goodsComent.user.user_login_name;//在这里用的是用户的登录名
																+"</span>"
															+"</div>";
									goodsCommentHtml=goodsCommentHtml
														+"</div>";
														
									goodsCommentHtml=goodsCommentHtml
														+"<p class=\"commentContent mui-text-left\">"+goodsComent.goods_comment_content+"</p>";
									var goodsCommentImages=goodsComent.images;
									goodsCommentHtml=goodsCommentHtml
														+"<div class=\"commentPic mui-row\">";
									for(var j=0;j<goodsCommentImages.length;j++){
										
										var goodsCommentImage=goodsCommentImages[j];
										//alert(goodsCommentImage.goods_comment_image_src);
										goodsCommentHtml=goodsCommentHtml
															+"<div class=\"mui-col-xs-3\">"
																+"<img class=\"mui-media-object\" src=\""+host+goodsCommentImage.goods_comment_image_src+"\">"
															+"</div>"; 
									}
									goodsCommentHtml=goodsCommentHtml
														+"</div>"
														
									goodsCommentHtml=goodsCommentHtml					
															+"<div class=\"mui-row\">"
																+"<span class=\"CommentUser mui-pull-right\">"
																+"<p>"+goodsComent.goods_comment_time+"</p>"
																+"</span>"
															+"</div>";
								}																	
								goodsCommentHtml=goodsCommentHtml													
									+"</li>"
								+"</ul>";
								document.getElementById("item4mobile").innerHTML=goodsCommentHtml;
							}else{//获取失败，给出提醒
								alert(data.message);
							}
							
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert("出现错误（请求响应超时）");
						}
					});	
			}
		</script>
		<script type="application/javascript">
			mui.init({
				swipeBack: true
			});
			window.addEventListener('goodsIndexDetailPage', function(options) {					
				var goodsID = options.detail.goodsID;
				getGoodsDetail(goodsID);
				//alert("goodsDetailById:"+goodsID);
				}, false);
			
			
		</script>
	</body>

</html>