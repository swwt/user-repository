<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>jianghua</title>
		<link rel="stylesheet" href="../css/mui.min.css" />
		<!--<link rel="stylesheet" href="../css/style.css" />-->
		<script src="../jsHostName/hostName.js"></script>
		<style type="text/css">
			#search .mui-segmented-control {
				border: 1px solid #ccc;
			}
			
			#search .mui-segmented-control .mui-control-item {
				border: none;
				color: #252525;
			}
			
			#search .mui-segmented-control .mui-control-item.mui-active {
				color: white;
				background-color: #F23030;
				border: none;
			}
			
			.mui-content-padded .mui-segmented-control .mui-control-item {
				font-size: 14px;
			}
			
			.mui-content-padded .mui-segmented-control .mui-control-item .mui-icon {
				font-size: 20px;
			}
			/*查询结果样式表*/
			.search-result .result-info .result-item{
				height: 110px;
			}
			
			.search-result .result-info .result-item .mui-media-object.item-info-img {
				max-width: 75px;
				height: 90px;
				line-height: 90px;
				margin-right: 10px;
			}
			
			.search-result .result-info .result-item .mui-media-body .item-info-des {
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
				font-size: 16px;
				color: #303030;
				margin-bottom: 10px;
			}
			
			.search-result .result-info .result-item .mui-media-body .item-info-price {
				font-size: 14px;
				color: #F23030;
			}
			
			.search-result .result-info .result-item .mui-media-body .item-info-price-detail {
				font-size: 18px;
				font-weight: bold;
			}
			
			.search-result .result-info .result-item .mui-media-body .item-info-comment,
			.search-result .result-info .result-item .mui-media-body .item-info-good-comment{
				font-size: 12px;
				margin-right: 8px;
			}
			
			
			
		</style>
		<script type="text/javascript">
		function goodsAction(listenWhat){
			mui.plusReady(function() {
				currentWebview = plus.webview.currentWebview();
				//parentWebview = plus.webview.currentWebview().parent();
				parentWebview=plus.webview.getWebviewById("HBuilder");//获取index的webview
				mui(listenWhat).on('tap', 'a', function() {
					var item = this;
					var itemID = this.getAttribute('href');
					var anishow = getaniShow();
//					alert("商品详情");
					//console.log("mui.fire goodsIndex.html"+ itemID);
					//弹入分类商品列表
					//alert("商品id:"+itemID);
					
					//alert(parentWebview.id);
					mui.fire(parentWebview, 'newWebView', {
						id: 'Home/goodsIndex-needtem.html',
						href: 'Home/goodsIndex-needtem.html',
						aniShow: anishow,
						title: '商品详情',
						isBars: false,
						barsIcon: '',
						product_id: itemID
					}, false);//product_id: itemID,
				});
			});
		}
			function getGoodsListByCategory2(catagory2_id){
				
				//------------获取综合排序的商品-----------
				//alert(catagory2_id);
				mui.ajax(host+'/goods/getByCatagory2ZongHe',{
						data:{
						 catagory2Id:catagory2_id
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//alert(data.message);
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
								//alert(data.message);
								goodsJSON=data.result;
								var zongheHtml="";
								for(var i=0;i<goodsJSON.length;i++){
									var goodsJSONSon=goodsJSON[i];
									var goodComment=goodsJSONSon.goods_grade.good;
									//alert(goodsJSONSon.goodsComments);
									zongheHtml=zongheHtml
									+"<li class=\"result-item mui-table-view-cell mui-media\" style=\"margin-bottom: 0;\">"
										+"<a href=\""+goodsJSONSon.id+"\">"
											+"<img class=\"item-info-img mui-media-object mui-pull-left\" src=\""+host+goodsJSONSon.images[0].goods_image_src+"\">"
											+"<div class=\"mui-media-body\" style=\"\">"
											+"<p class=\"item-info-des mui-ellipsis-2\">"+goodsJSONSon.goods_name+"</p>"
											+"<p class='item-info-price' style=\"font-size: 14px;color:#DD524D\">￥<span class=\"item-info-price-detail\" style=\"\">"+goodsJSONSon.goodsPrices[0].goods_price_specific+"</span></p>"
											+"<p class='' style=\"\">"
												+"<span class=\"item-info-comment\">"+goodsJSONSon.goodsCommentNumber+"条评价</span>"
												+"<span class=\"item-info-good-comment\">好评"+goodComment+"%</span>"
											+"</p>"
											+"</div>"
										+"</a>"
									+"</li>";
								}
								
								document.getElementById("zonghe").innerHTML=zongheHtml;
								goodsAction('#item1mobile');
							}else{//获取失败，给出提醒
								alert(data.message);
							}
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert(xhr);
							alert(type);
							alert(errorThrown);
							alert("出现错误（请求响应超时）");
						}
					});
					//------------获取销量排序的商品-----------
				mui.ajax(host+'/goods/getByCatagory2Sellors',{
						data:{
						 catagory2Id:catagory2_id
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
								//alert(data.message);
								goodsJSON=data.result;
								var zongheHtml="";
								for(var i=0;i<goodsJSON.length;i++){
									var goodsJSONSon=goodsJSON[i];
									var goodComment=goodsJSONSon.goods_grade.good;
									//alert(goodsJSONSon.goodsComments);
									zongheHtml=zongheHtml
									+"<li class=\"result-item mui-table-view-cell mui-media\" style=\"margin-bottom: 0;\">"
										+"<a href=\""+goodsJSONSon.id+"\">"
											+"<img class=\"item-info-img mui-media-object mui-pull-left\" src=\""+host+goodsJSONSon.images[0].goods_image_src+"\">"
											+"<div class=\"mui-media-body\" style=\"\">"
											+"<p class=\"item-info-des mui-ellipsis-2\">"+goodsJSONSon.goods_name+"</p>"
											+"<p class='item-info-price' style=\"font-size: 14px;color:#DD524D\">￥<span class=\"item-info-price-detail\" style=\"\">"+goodsJSONSon.goodsPrices[0].goods_price_specific+"</span></p>"
											+"<p class='' style=\"\">"
												+"<span class=\"item-info-good-comment\">销量"+goodsJSONSon.goodsSells+"件</span>"
												+"<span class=\"item-info-comment\">"+goodsJSONSon.goodsCommentNumber+"条评价</span>"
												+"<span class=\"item-info-good-comment\">好评"+goodComment+"%</span>"
											
											+"</p>"
											+"</div>"
										+"</a>"
									+"</li>";
								}
								
								document.getElementById("sells").innerHTML=zongheHtml;
								goodsAction('#item2mobile');
							}else{//获取失败，给出提醒
								alert(data.message);
							}
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert("出现错误（请求响应超时）");
						}
					});
				//-------获取价格排序商品-------------
				mui.ajax(host+'/goods/getByCatagory2PriceUp',{
						data:{
						 catagory2Id:catagory2_id
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
							//	alert(data.message);
								goodsJSON=data.result;
								var zongheHtml="";
								for(var i=0;i<goodsJSON.length;i++){
									var goodsJSONSon=goodsJSON[i];
									var goodComment=goodsJSONSon.goods_grade.good;
									//alert(goodsJSONSon.goodsComments);
									zongheHtml=zongheHtml
									+"<li class=\"result-item mui-table-view-cell mui-media\" style=\"margin-bottom: 0;\">"
										+"<a href=\""+goodsJSONSon.id+"\">"
											+"<img class=\"item-info-img mui-media-object mui-pull-left\" src=\""+host+goodsJSONSon.images[0].goods_image_src+"\">"
											+"<div class=\"mui-media-body\" style=\"\">"
											+"<p class=\"item-info-des mui-ellipsis-2\">"+goodsJSONSon.goods_name+"</p>"
											+"<p class='item-info-price' style=\"font-size: 14px;color:#DD524D\">￥<span class=\"item-info-price-detail\" style=\"\">"+goodsJSONSon.goodsPrices[0].goods_price_specific+"</span></p>"
											+"<p class='' style=\"\">"
												+"<span class=\"item-info-good-comment\">销量"+goodsJSONSon.goodsSells+"件</span>"
												+"<span class=\"item-info-comment\">"+goodsJSONSon.goodsCommentNumber+"条评价</span>"
												+"<span class=\"item-info-good-comment\">好评"+goodComment+"%</span>"
											
											+"</p>"
											+"</div>"
										+"</a>"
									+"</li>";
								}
								
								document.getElementById("price").innerHTML=zongheHtml;
								goodsAction('#item3mobile');
							}else{//获取失败，给出提醒
								alert(data.message);
							}
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert("出现错误（请求响应超时）");
						}
					});
			}
			
			//------------------------------------------------------------------------------------------------------
			function getGoodsListBySearch(search_name){
				
				//------------获取综合排序的商品-----------
				//alert(catagory2_id);
				mui.ajax(host+'/goods/getByNameOrderByZongHe',{
						data:{
						 name:search_name
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//alert(data.message);
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
								//alert(data.message);
								goodsJSON=data.result;
								var zongheHtml="";
								for(var i=0;i<goodsJSON.length;i++){
									var goodsJSONSon=goodsJSON[i];
									var goodComment=goodsJSONSon.goods_grade.good;
									//alert(goodsJSONSon.goodsComments);
									zongheHtml=zongheHtml
									+"<li class=\"result-item mui-table-view-cell mui-media\" style=\"margin-bottom: 0;\">"
										+"<a href=\""+goodsJSONSon.id+"\">"
											+"<img class=\"item-info-img mui-media-object mui-pull-left\" src=\""+host+goodsJSONSon.images[0].goods_image_src+"\">"
											+"<div class=\"mui-media-body\" style=\"\">"
											+"<p class=\"item-info-des mui-ellipsis-2\">"+goodsJSONSon.goods_name+"</p>"
											+"<p class='item-info-price' style=\"font-size: 14px;color:#DD524D\">￥<span class=\"item-info-price-detail\" style=\"\">"+goodsJSONSon.goodsPrices[0].goods_price_specific+"</span></p>"
											+"<p class='' style=\"\">"
												+"<span class=\"item-info-comment\">"+goodsJSONSon.goodsCommentNumber+"条评价</span>"
												+"<span class=\"item-info-good-comment\">好评"+goodComment+"%</span>"
											+"</p>"
											+"</div>"
										+"</a>"
									+"</li>";
								}
								//alert(zongheHtml);
								document.getElementById("zonghe").innerHTML=zongheHtml;
								goodsAction('#item1mobile');
							}else{//获取失败，给出提醒
								alert(data.message);
							}
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert(xhr);
							alert(type);
							alert(errorThrown);
							alert("出现错误（请求响应超时）");
						}
					});
					//------------获取销量排序的商品-----------
				mui.ajax(host+'/goods/getByNameOrderBySellors',{
						data:{
						 name:search_name
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
							//	alert(data.message);
								goodsJSON=data.result;
								var zongheHtml="";
								for(var i=0;i<goodsJSON.length;i++){
									var goodsJSONSon=goodsJSON[i];
									var goodComment=goodsJSONSon.goods_grade.good;
									//alert(goodsJSONSon.goodsComments);
									zongheHtml=zongheHtml
									+"<li class=\"result-item mui-table-view-cell mui-media\" style=\"margin-bottom: 0;\">"
										+"<a href=\""+goodsJSONSon.id+"\">"
											+"<img class=\"item-info-img mui-media-object mui-pull-left\" src=\""+host+goodsJSONSon.images[0].goods_image_src+"\">"
											+"<div class=\"mui-media-body\" style=\"\">"
											+"<p class=\"item-info-des mui-ellipsis-2\">"+goodsJSONSon.goods_name+"</p>"
											+"<p class='item-info-price' style=\"font-size: 14px;color:#DD524D\">￥<span class=\"item-info-price-detail\" style=\"\">"+goodsJSONSon.goodsPrices[0].goods_price_specific+"</span></p>"
											+"<p class='' style=\"\">"
												+"<span class=\"item-info-good-comment\">销量"+goodsJSONSon.goodsSells+"件</span>"
												+"<span class=\"item-info-comment\">"+goodsJSONSon.goodsCommentNumber+"条评价</span>"
												+"<span class=\"item-info-good-comment\">好评"+goodComment+"%</span>"
											
											+"</p>"
											+"</div>"
										+"</a>"
									+"</li>";
								}
								
								document.getElementById("sells").innerHTML=zongheHtml;
								goodsAction('#item2mobile');
							}else{//获取失败，给出提醒
								alert(data.message);
							}
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert("出现错误（请求响应超时）");
						}
					});
				//-------获取价格排序商品-------------
				mui.ajax(host+'/goods/getByNameOrderByPriceUp',{
						data:{
						 name:search_name
						},
						async: true,//设为异步请求
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						success:function(data){
							//服务器返回响应，根据响应结果，分析是否成功获取数据；							
							if(data.code==1){//表示获取成功
								//alert(data.message);
								goodsJSON=data.result;
								var zongheHtml="";
								for(var i=0;i<goodsJSON.length;i++){
									var goodsJSONSon=goodsJSON[i];
									var goodComment=goodsJSONSon.goods_grade.good;
									//alert(goodsJSONSon.goodsComments);
									zongheHtml=zongheHtml
									+"<li class=\"result-item mui-table-view-cell mui-media\" style=\"margin-bottom: 0;\">"
										+"<a href=\""+goodsJSONSon.id+"\">"
											+"<img class=\"item-info-img mui-media-object mui-pull-left\" src=\""+host+goodsJSONSon.images[0].goods_image_src+"\">"
											+"<div class=\"mui-media-body\" style=\"\">"
											+"<p class=\"item-info-des mui-ellipsis-2\">"+goodsJSONSon.goods_name+"</p>"
											+"<p class='item-info-price' style=\"font-size: 14px;color:#DD524D\">￥<span class=\"item-info-price-detail\" style=\"\">"+goodsJSONSon.goodsPrices[0].goods_price_specific+"</span></p>"
											+"<p class='' style=\"\">"
												+"<span class=\"item-info-good-comment\">销量"+goodsJSONSon.goodsSells+"件</span>"
												+"<span class=\"item-info-comment\">"+goodsJSONSon.goodsCommentNumber+"条评价</span>"
												+"<span class=\"item-info-good-comment\">好评"+goodComment+"%</span>"
											
											+"</p>"
											+"</div>"
										+"</a>"
									+"</li>";
								}
								
								document.getElementById("price").innerHTML=zongheHtml;
								goodsAction('#item3mobile');
							}else{//获取失败，给出提醒
								alert(data.message);
							}
						},
						error:function(xhr,type,errorThrown){ 
							//异常处理；
							//console.log(type);
							alert("出现错误（请求响应超时）");
						}
					});
			}
		</script>
	</head>

	<body>
		<div id="search" class="mui-content-padded">
			<div id="segmentedControl" class="mui-segmented-control">
				<a class="mui-control-item mui-active" href="#item1mobile">
					综合
					<span class="mui-icon mui-icon-arrowdown"></span>
				</a>
				<a class="mui-control-item" href="#item2mobile">
					销量
					<span class="mui-icon mui-icon-arrowdown"></span>
				</a>
				<a class="mui-control-item" href="#item3mobile">
					价格
					<span class="mui-icon mui-icon-arrowup"></span>
				</a>
			</div>
			<div class="search-result">
				<div id="item1mobile" class="result-info mui-control-content mui-active">
					<ul class="mui-table-view" id="zonghe">
						<!--<li class="result-item mui-table-view-cell mui-media" style="margin-bottom: 0;">
							<a href="#">
								<img class="item-info-img mui-media-object mui-pull-left" src="../img/shuijiao.jpg">
								<div class="mui-media-body" style="">
									<p class="item-info-des mui-ellipsis-2">湖南湘西沅陵特产大山野生新鲜板栗生板栗生栗子毛栗子油栗500克</p>
									<p class='item-info-price' style="font-size: 14px;color:#DD524D">￥<span class="item-info-price-detail" style="">11.90</span></p>
									<p class='' style="">
										<span class="item-info-comment">75788条评价</span>
										<span class="item-info-good-comment">好评97%</span>
									</p>
								</div>
							</a>
						</li>-->
					</ul>
				</div>
				<div id="item2mobile" class="result-info mui-control-content">
					<ul class="mui-table-view" id="sells">
						<!--<li class="result-item mui-table-view-cell mui-media" style="margin-bottom: 0;">
							<a href="#">
								<img class="item-info-img mui-media-object mui-pull-left" src="../img/shuijiao.jpg">
								<div class="mui-media-body" style="">
									<p class="item-info-des mui-ellipsis-2">湖南湘西沅陵特产大山野生新鲜板栗生板栗生栗子毛栗子油栗500克</p>
									<p class='item-info-price' style="font-size: 14px;color:#DD524D">￥<span class="item-info-price-detail" style="">11.90</span></p>
									<p class='' style="">
										<span class="item-info-comment">75788条评价</span>
										<span class="item-info-good-comment">好评97%</span>
									</p>
								</div>
							</a>
						</li>
						<li class="result-item mui-table-view-cell mui-media" style="margin-bottom: 0;">
							<a href="#">
								<img class="item-info-img mui-media-object mui-pull-left" src="../img/shuijiao.jpg">
								<div class="mui-media-body" style="">
									<p class="item-info-des mui-ellipsis-2">湖南湘西沅陵特产大山野生新鲜板栗生板栗生栗子毛栗子油栗500克</p>
									<p class='item-info-price' style="font-size: 14px;color:#DD524D">￥<span class="item-info-price-detail" style="">11.90</span></p>
									<p class='' style="">
										<span class="item-info-comment">75788条评价</span>
										<span class="item-info-good-comment">好评97%</span>
									</p>
								</div>
							</a>
						</li>-->
					</ul>
				</div>
				<div id="item3mobile" class="result-info mui-control-content">
					<ul class="mui-table-view" id="price">
						<!--<li class="result-item mui-table-view-cell mui-media" style="margin-bottom: 0;">
							<a href="#">
								<img class="item-info-img mui-media-object mui-pull-left" src="../img/shuijiao.jpg">
								<div class="mui-media-body" style="">
									<p class="item-info-des mui-ellipsis-2">湖南湘西沅陵特产大山野生新鲜板栗生板栗生栗子毛栗子油栗500克</p>
									<p class='item-info-price' style="font-size: 14px;color:#DD524D">￥<span class="item-info-price-detail" style="">11.90</span></p>
									<p class='' style="">
										<span class="item-info-comment">75788条评价</span>
										<span class="item-info-good-comment">好评97%</span>
									</p>
								</div>
							</a>
						</li>-->
					</ul>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/main.js"></script>
		<script type="application/javascript" src="../js/own.js"></script>
		<script type="application/javascript">
		 mui.init({
				swipeBack: false 
			});
			
		window.addEventListener('searchPageFire', function(options) {					
			var categoryID = options.detail.categoryID;
			var listType=options.detail.listType;//判断是搜索还是二级分类下的商品展示
			//alert(listType);
			if(listType=='byCategoty2List'){ 
				
				getGoodsListByCategory2(categoryID);//二级分类下的商品展示
			}else{
				getGoodsListBySearch(categoryID);//商品搜索
			}
			//alert("searchPage:"+categoryID);
			//getGoodsListByCategory2(categoryID);
		}, false);
		
		
		</script>
	</body>

</html>